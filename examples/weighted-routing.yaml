# BLIS Weighted Routing — Composable Scorer Pipeline
#
# The `weighted` routing policy aggregates multiple scoring dimensions,
# each evaluating instances on a [0,1] scale. Scores are combined with
# configurable weights: score = clamp(s_i) * w_i, then argmax.
#
# Available scorers:
#   prefix-affinity — proportional prefix match ratio via router-side cache
#   queue-depth     — min-max normalization of effective load (llm-d match)
#   kv-utilization  — inverse utilization: 1 - KVUtilization (llm-d match)
#   load-balance    — inverse transform: 1/(1 + effectiveLoad) (BLIS-native)
#
# Default profile (when --routing-scorers is not specified):
#   prefix-affinity:3, queue-depth:2, kv-utilization:2 (llm-d parity)
#
# Weights are relative — only ratios matter. [3,2,2] behaves identically
# to [0.43,0.29,0.29]. The framework normalizes weights to sum to 1.0.
#
# ============================================================================
# TRY IT: Compare scorer configurations
# ============================================================================
#
#   # Default profile (llm-d parity: prefix-affinity dominant)
#   ./simulation_worker run \
#     --model meta-llama/llama-3.1-8b-instruct \
#     --num-instances 4 --routing-policy weighted \
#     --workload-spec examples/servegen-language.yaml \
#     --trace-level decisions --summarize-trace
#
#   # Prefix-affinity dominant (maximize cache reuse)
#   ./simulation_worker run \
#     --model meta-llama/llama-3.1-8b-instruct \
#     --num-instances 4 --routing-policy weighted \
#     --routing-scorers "prefix-affinity:5,queue-depth:1" \
#     --workload-spec examples/servegen-language.yaml \
#     --trace-level decisions --summarize-trace
#
#   # Load-balance only (no prefix awareness, equivalent to least-loaded)
#   ./simulation_worker run \
#     --model meta-llama/llama-3.1-8b-instruct \
#     --num-instances 4 --routing-policy weighted \
#     --routing-scorers "load-balance:1" \
#     --workload-spec examples/servegen-language.yaml \
#     --trace-level decisions --summarize-trace
#
# ============================================================================
# Adding new scorers
# ============================================================================
#
# To add a new scorer:
# 1. Implement the scorer function in sim/routing_scorers.go (or a new file
#    like sim/routing_prefix_scorer.go for stateful scorers)
# 2. Register the name in validScorerNames + newScorerWithObserver factory
# Extension friction: 2 touch points.

admission:
  policy: always-admit

routing:
  policy: weighted
  scorers:
    - name: prefix-affinity
      weight: 3.0
    - name: queue-depth
      weight: 2.0
    - name: kv-utilization
      weight: 2.0

priority:
  policy: constant

scheduler: fcfs
